# üìç Map Tile Generator

This project helps you visualize geographic areas using custom-stitched map tiles extracted from `.mbtiles` vector tile packages. With just a few steps, you can generate high-resolution maps and crop them to a custom size around a specific latitude/longitude‚Äîcomplete with a marker overlay.

---

## üìë Table of Contents

- [Requirements](#requirements)
- [Setup Instructions](#setup-instructions)
- [Understanding Tile Zoom Levels](#understanding-tile-zoom-levels)
- [Virtual Environments & Dependency Management](#virtual-environments--dependency-management)
- [Script Breakdown](#script-breakdown)
- [Usage Instructions](#usage-instructions)
- [Calling Functions Programmatically](#calling-functions-programmatically)
- [Troubleshooting](#troubleshooting)

---

## Requirements

- **Python 3.7+**
- Required packages:
  - `mbutil`
  - `matplotlib`
  - `geopandas`
  - `shapely`
  - `mapbox-vector-tile`
  - `Pillow`

Install them with:

```bash
pip install mbutil matplotlib geopandas shapely mapbox-vector-tile Pillow
```

---

## Setup Instructions

1. **Get Your `.mbtiles` File**

   You can download a sample `.mbtiles` file from [MapTiler](https://data.maptiler.com/downloads/dataset/osm/north-america/us/south-carolina/#6.49/33.639/-80.937) for a specific region.

2. **Install MBUtil**

   MBUtil is a command-line tool to unpack `.mbtiles` files:

   ```bash
   pip install mbutil
   ```

3. **Extract MBTILES**

   Unpack the tiles into a folder:

   ```bash
   mb-util your_file.mbtiles new_output_folder
   ```

   This folder will contain a hierarchy of folders: `zoom/x/y.png` for each tile.

---

## Understanding Tile Zoom Levels

Zoom levels define the number of tiles used to represent the world:

| Zoom Level | World Coverage       |
|------------|----------------------|
| 0          | 1 tile (2‚Å∞)          |
| 1          | 4 tiles (2¬π x 2¬π)    |
| 14         | 268M+ tiles (2¬π‚Å¥ x 2¬π‚Å¥)   |

The higher the zoom, the smaller and more detailed the area each tile covers. For instance:

- At **zoom level 14**, each tile near the equator covers roughly **1.22 km √ó 1.22 km**.
- Zoom levels are exponentially scaled and essential for tuning how much area your map image spans.

---

## Virtual Environments & Dependency Management

Using a virtual environment is **highly recommended** for development.

### Why Use One?

- Prevents package version conflicts
- Keeps your system Python clean
- Makes your project more portable and reproducible

### Create One

```bash
python -m venv env
source env/bin/activate  # Windows: env\Scripts\activate
```

Then install the required packages.

---

## Script Breakdown

### `generate_map.py`

- **Purpose:** Creates a 3√ó3 grid of tiles centered on a given lat/lon.
- **What it does:**
  - Translates coordinates to tile indices
  - Extracts and decodes vector data
  - Styles and renders the map
  - Saves the output as a high-res PNG

---

### `main.py`

- **Purpose:** Crops the image generated by `generate_map.py` and places a marker at the center.
- **What it does:**
  - Crops to a custom pixel size
  - Adds a circular marker at the target lat/lon
  - Saves the final cropped image

---

## Usage Instructions

### Run Example Directly

You can use the included `if __name__ == "__main__":` blocks in each script to run everything:

```bash
python generate_map.py
python main.py
```

These will generate a full stitched image and a cropped/marked image based on the sample coordinates.

---

## Calling Functions Programmatically

If you'd rather import and use the functions in your own scripts, here‚Äôs how.

---

### üìç `generate_map_image(...)`

**From:** `generate_map.py`

```python
from generate_map import generate_map_image

output_path = generate_map_image(
    base_dir="tiles/",
    lat=34.05,
    lon=-81.0,
    zoom=14,
    inches=10,
    dpi=300
)
```

**Arguments:**

| Param       | Description                           |
|-------------|---------------------------------------|
| `base_dir`  | Folder containing your unpacked tiles |
| `lat`, `lon`| Center point                          |
| `zoom`      | Tile zoom level                       |
| `inches`    | Physical size of image                |
| `dpi`       | Resolution                            |
| `extent`    | (Optional) Tile vector resolution     |
| `output_dir`| (Optional) Where to save the image    |

---

### `crop_map_fixed_size(...)`

**From:** `main.py`

```python
from main import crop_map_fixed_size

crop_map_fixed_size(
    base_dir="tiles/",
    center_lat=34.05,
    center_lon=-81.0,
    zoom=14,
    inches=10,
    dpi=300,
    out_width_px=300,
    out_height_px=300,
    marker_radius=15
)
```

**Arguments (in addition to `generate_map_image`):**

| Param          | Description                                |
|----------------|--------------------------------------------|
| `out_width_px` | Width of final cropped image (in pixels)   |
| `out_height_px`| Height of final cropped image (in pixels)  |
| `marker_radius`| Radius of the circular marker in pixels    |

---

## Troubleshooting

- **No features extracted?**  
  Make sure your tile set includes vector layers, and the lat/lon you're requesting falls within the tile coverage.

- **Cropped image too small?**  
  Your zoom/inch/dpi settings affect scale‚Äîadjust `inches` or `dpi` to get a larger stitched image.

- **Invalid filename format?**  
  The crop function parses bounding box info from the filename. Don‚Äôt rename the generated `.png`.

- **Missing packages?**  
  Double check you're using a virtual environment and have run:
  ```bash
  pip install mbutil matplotlib geopandas shapely mapbox-vector-tile Pillow
  ```
